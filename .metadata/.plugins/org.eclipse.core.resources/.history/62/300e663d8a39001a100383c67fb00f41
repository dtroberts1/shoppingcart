package com.enterprisesim.view;

import java.awt.BorderLayout;    
import java.awt.GridLayout; 

import javax.swing.BoxLayout;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;
import com.enterprisesim.*;
import com.enterprisesim.model.Order;
import com.enterprisesim.model.BookData;
import com.enterprisesim.model.MyModel;
import com.enterprisesim.model.Updater;
import com.enterprisesim.view.ButtonWithExtras;
import com.enterprisesim.Listeners.MyListeners;


public class GUIView implements Updater{
	
	public static MyModel model;
	static JFrame myFrame;
	ButtonWithExtras processBtn = new ButtonWithExtras();
	processBtn.setGui
	ButtonWithExtras confirmBtn = new ButtonWithExtras();
	ButtonWithExtras viewOrderBtn = new ButtonWithExtras();
	ButtonWithExtras finishOrderBtn = new ButtonWithExtras();
	ButtonWithExtras newOrderBtn = new ButtonWithExtras();
	ButtonWithExtras exitBtn = new ButtonWithExtras();
	
	private JLabel nbrItemsLabel;
	private JLabel bookIDLabel ;
	private JLabel qtyLabel;
	private JLabel itemInfoLabel;
	private JLabel itemSubtotalLabel;
	
	public static JTextField nbrItemsTxt;
	private JTextField bookIDTxt; 
	private JTextField qtyTxt; 
	private JTextField itemsInfoTxt; 
	private JTextField itemSubtotalTxt; 

    JPanel upperPane;
    JPanel inputPane;
    JPanel labelPane;
    
    public JTextField getBookIDTxt() {
    	return this.bookIDTxt;
    }
    
	public static class TransactionItem extends BookData{
		//public int itemNbr;
		public int qty;
		public double discountPercent;
		public double subTotal;
	}
	
	public static BookData isValid() {
		// iterate through all the items from inventory and check if there is matching book id,
		// then return the book corresponding to the book ID
		return null;
	}
	
	public GUIView() {
		
		MyModel.isProcessed = true;
		initializeGUI(model);
	}
	public static void reset() {
		MyModel.currentItemNbr = 0;
		MyModel.maxItems = 0;
		MyModel.isProcessed = true;
		processBtn.setEnabled(true);
		confirmBtn.setEnabled(false);
		viewOrderBtn.setEnabled(false);
		finishOrderBtn.setEnabled(false);
	}
	
	@Override
	public void update(Order order) {
		System.out.print("made it to a");

		MyModel.setNbrItems(nbrItemsTxt);
		System.out.print("made it to b");

		BookData currentBookData = new BookData();
		System.out.print("made it to c");

		processBtn.setText("Process Item #" + MyModel.currentItemNbr);
		confirmBtn.setText("Confirm Item #" + MyModel.currentItemNbr);
		if (MyModel.currentItemNbr < MyModel.maxItems)
		{
			if (MyModel.isProcessed == true)
			{
				// If new item is processed
				System.out.println("New Item is processed.");
				processBtn.setEnabled(false);
				confirmBtn.setEnabled(true);
				MyModel.isProcessed = false;
				if (MyModel.currentItemNbr == 0) {
					System.out.print("now creating order, (Max items is " + MyModel.maxItems);
					order = new Order(MyModel.maxItems);
				}
				
			}
			// If new item is confirmed
			else if (MyModel.isProcessed == false) {
				
				//=========== Verify valid item
	//			BookData bookData = isValid();
				//===========
				
				MyModel.processItem();
				System.out.println("New Item is Confirmed");
				if (MyModel.currentItemNbr < MyModel.maxItems) // if the last confirmed item isn't the last
					processBtn.setEnabled(true);
				else {
					// Enable the other buttons
					viewOrderBtn.setEnabled(true);
					finishOrderBtn.setEnabled(true);
				}
				confirmBtn.setEnabled(false);
				MyModel.isProcessed = true;
	//			currentBookData.bookID = 
	//			order.addItem(bookData, quantity, bookTitleAndAuth);
			}		
		}
		else {
			processBtn.setEnabled(false);
			confirmBtn.setEnabled(false);
			System.out.println("==========");
			System.out.println("currentItemCount: " + MyModel.currentItemNbr);
			System.out.println("Max Count: " + MyModel.maxItems);
			System.out.println("isProcessed: " + MyModel.isProcessed);
		}
		System.out.println("refreshing..");
	}
    
    public void initializeGUI(MyModel model) {
		// Frame
		myFrame = new JFrame();
		myFrame.setBounds(420, 120, 750, 500);
		myFrame.setLocationRelativeTo(null);
		
		MyListeners myListener = new MyListeners();
		
		GUIView.processBtn = new JButton("Process Item #" + MyModel.currentItemNbr);
		processBtn.addActionListener(myListener);
		
		// Buttons
		confirmBtn = new JButton("Confirm Item #" + MyModel.currentItemNbr);
		confirmBtn.addActionListener(myListener);

		confirmBtn.setEnabled(false);
		viewOrderBtn = new JButton("View Order");
		viewOrderBtn.setEnabled(false);
		finishOrderBtn = new JButton("Finish Order");
		finishOrderBtn.setEnabled(false);
		newOrderBtn = new JButton("New Order");
		newOrderBtn.addActionListener(myListener);
		exitBtn = new JButton("Exit");
		
	    JFrame.setDefaultLookAndFeelDecorated(true);
	    nbrItemsLabel = new JLabel("Enter Number of Items For this Order:");
	    bookIDLabel = new JLabel("Enter Book ID for Item #X:");
	    qtyLabel = new JLabel("Enter Quantity for Item #X:");
	    itemInfoLabel = new JLabel("Item #X Info:");
	    itemSubtotalLabel = new JLabel("Subtotal for X items:");
	    
	    nbrItemsTxt = new JTextField("", 30); 
	    bookIDTxt = new JTextField("", 30);
	    qtyTxt = new JTextField("", 30); 
	    itemsInfoTxt = new JTextField("", 30); 
	    itemSubtotalTxt = new JTextField("", 30); 
	    
	    upperPane = new JPanel();
	    inputPane = new JPanel();
	    labelPane = new JPanel();
	    
	    labelPane.add(nbrItemsLabel);
	    labelPane.add(bookIDLabel);
	    labelPane.add(qtyLabel);
	    labelPane.add(itemInfoLabel);
	    labelPane.add(itemSubtotalLabel);
	    
	    inputPane.add(nbrItemsTxt);
	    inputPane.add(bookIDTxt);
	    inputPane.add(qtyTxt);
	    inputPane.add(itemsInfoTxt);
	    inputPane.add(itemSubtotalTxt);

	    inputPane.setLayout(new BoxLayout(inputPane, BoxLayout.Y_AXIS));
	    labelPane.setLayout(new BoxLayout(labelPane, BoxLayout.Y_AXIS));

	    upperPane.add(labelPane);
	    upperPane.add(inputPane);
	    
	    inputPane.setBounds(0, 0, 200, 300);
		
		JPanel lowerGrid = new JPanel(new GridLayout(1,3));
		lowerGrid.add(processBtn);
		
		lowerGrid.add(confirmBtn);
		lowerGrid.add(viewOrderBtn);
		lowerGrid.add(finishOrderBtn);
		lowerGrid.add(newOrderBtn);
		lowerGrid.add(exitBtn);
		

		myFrame.add(upperPane, BorderLayout.NORTH);

		myFrame.add(lowerGrid, BorderLayout.SOUTH);
		myFrame.setVisible(true);
    }
}
