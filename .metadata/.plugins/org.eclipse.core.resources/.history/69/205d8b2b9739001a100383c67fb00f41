package com.enterprisesim.view;

import java.awt.BorderLayout;    
import java.awt.GridLayout; 

import javax.swing.BoxLayout;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;
import com.enterprisesim.*;
import com.enterprisesim.model.Order;
import com.enterprisesim.model.BookData;
import com.enterprisesim.model.MyModel;
import com.enterprisesim.model.Updater;
import com.enterprisesim.model.Inventory;
import com.enterprisesim.view.ButtonWithExtras;
import com.enterprisesim.Listeners.MyListeners;


public class GUIView implements Updater{
	
	public static MyModel model;
	static JFrame myFrame;
	public ButtonWithExtras processBtn;
	BookData currentBookData;
	
	ButtonWithExtras confirmBtn = new ButtonWithExtras();
	ButtonWithExtras viewOrderBtn = new ButtonWithExtras();
	ButtonWithExtras finishOrderBtn = new ButtonWithExtras();
	ButtonWithExtras newOrderBtn = new ButtonWithExtras();
	ButtonWithExtras exitBtn = new ButtonWithExtras();
	
	private JLabel nbrItemsLabel;
	private JLabel bookIDLabel ;
	private JLabel qtyLabel;
	private JLabel itemInfoLabel;
	private JLabel itemSubtotalLabel;
	Inventory myInventory;
	
	public static JTextField nbrItemsTxt;
	private JTextField bookIDTxt; 
	private JTextField qtyTxt; 
	private JTextField itemsInfoTxt; 
	private JTextField itemSubtotalTxt; 

    JPanel upperPane;
    JPanel inputPane;
    JPanel labelPane;
    
    public int getBookQty() {
    	return Integer.parseInt(this.qtyTxt.getText());
    }
    public String getBookIDTxt() {
    	return this.bookIDTxt.getText();
    }
    
	public static class TransactionItem extends BookData{
		//public int itemNbr;
		public int qty;
		public double discountPercent;
		public double subTotal;
	}
	
	public static BookData isValid() {
		// iterate through all the items from inventory and check if there is matching book id,
		// then return the book corresponding to the book ID
		return null;
	}
	
	public GUIView(Inventory myInventory) {
		model = new MyModel();
		model.isProcessed = true;
		currentBookData = new BookData();
		initializeGUI(model);
		this.myInventory = myInventory;
		System.out.print("in constructor, inventory is " + this.myInventory.getAllBooks().toString());
	}
	public void reset() {
		model.currentItemNbr = 0;
		model.maxItems = 0;
		model.isProcessed = true;
		processBtn.setEnabled(true);
		confirmBtn.setEnabled(false);
		viewOrderBtn.setEnabled(false);
		finishOrderBtn.setEnabled(false);
	}
	
	@Override
	public void update(Order order) {
		System.out.print("made it to a");

		model.setNbrItems(nbrItemsTxt);
		System.out.print("made it to b");

		System.out.print("made it to c");

		processBtn.setText("Process Item #" + model.currentItemNbr);
		confirmBtn.setText("Confirm Item #" + model.currentItemNbr);
		if (model.currentItemNbr < model.maxItems)
		{
			if (model.isProcessed == true)
			{
				// If new item is processed
				System.out.println("New Item is processed.");
				processBtn.setEnabled(false);
				confirmBtn.setEnabled(true);
				model.isProcessed = false;
				if (model.currentItemNbr == 0) {
					System.out.print("now creating order, (Max items is " + model.maxItems);
					order = new Order(model.maxItems);
				}
				
			}
			// If new item is confirmed
			else if (model.isProcessed == false) {
				
				//=========== Verify valid item
	//			BookData bookData = isValid();
				//===========
				
				model.processItem();
				System.out.println("New Item is Confirmed");
				if (model.currentItemNbr < model.maxItems) // if the last confirmed item isn't the last
					processBtn.setEnabled(true);
				else {
					// Enable the other buttons
					viewOrderBtn.setEnabled(true);
					finishOrderBtn.setEnabled(true);
				}
				confirmBtn.setEnabled(false);
				model.isProcessed = true;
				BookData currentBookData = this.myInventory.isInInventory(this.getBookIDTxt());
				
	//			this.currentBookData.bookTitleAndAuth = this.
				
				order.addItem(currentBookData, this.getBookQty());
			}		
		}
		else {
			processBtn.setEnabled(false);
			confirmBtn.setEnabled(false);
			System.out.println("==========");
			System.out.println("currentItemCount: " + model.currentItemNbr);
			System.out.println("Max Count: " + model.maxItems);
			System.out.println("isProcessed: " + model.isProcessed);
		}
		System.out.println("refreshing..");
	}
    
    public void initializeGUI(MyModel model) {
		// Frame
		myFrame = new JFrame();
		myFrame.setBounds(420, 120, 750, 500);
		myFrame.setLocationRelativeTo(null);
		
		MyListeners myListener = new MyListeners();
		processBtn = new ButtonWithExtras("Process Item #" + model.currentItemNbr);
		processBtn.setBtnParent(this);
		processBtn.addActionListener(myListener);
		
		// Buttons
		confirmBtn = new ButtonWithExtras("Confirm Item #" + model.currentItemNbr);
		confirmBtn.setBtnParent(this);
		confirmBtn.addActionListener(myListener);

		confirmBtn.setEnabled(false);
		viewOrderBtn = new ButtonWithExtras("View Order");
		viewOrderBtn.setBtnParent(this);
		viewOrderBtn.setEnabled(false);
		finishOrderBtn = new ButtonWithExtras("Finish Order");
		finishOrderBtn.setBtnParent(this);
		finishOrderBtn.setEnabled(false);
		newOrderBtn = new ButtonWithExtras("New Order");
		newOrderBtn.setBtnParent(this);
		newOrderBtn.addActionListener(myListener);
		exitBtn = new ButtonWithExtras("Exit");
		
		
	    JFrame.setDefaultLookAndFeelDecorated(true);
	    nbrItemsLabel = new JLabel("Enter Number of Items For this Order:");
	    bookIDLabel = new JLabel("Enter Book ID for Item #X:");
	    qtyLabel = new JLabel("Enter Quantity for Item #X:");
	    itemInfoLabel = new JLabel("Item #X Info:");
	    itemSubtotalLabel = new JLabel("Subtotal for X items:");
	    
	    nbrItemsTxt = new JTextField("", 30); 
	    bookIDTxt = new JTextField("", 30);
	    qtyTxt = new JTextField("", 30); 
	    itemsInfoTxt = new JTextField("", 30); 
	    itemSubtotalTxt = new JTextField("", 30); 
	    
	    upperPane = new JPanel();
	    inputPane = new JPanel();
	    labelPane = new JPanel();
	    
	    labelPane.add(nbrItemsLabel);
	    labelPane.add(bookIDLabel);
	    labelPane.add(qtyLabel);
	    labelPane.add(itemInfoLabel);
	    labelPane.add(itemSubtotalLabel);
	    
	    inputPane.add(nbrItemsTxt);
	    inputPane.add(bookIDTxt);
	    inputPane.add(qtyTxt);
	    inputPane.add(itemsInfoTxt);
	    inputPane.add(itemSubtotalTxt);

	    inputPane.setLayout(new BoxLayout(inputPane, BoxLayout.Y_AXIS));
	    labelPane.setLayout(new BoxLayout(labelPane, BoxLayout.Y_AXIS));

	    upperPane.add(labelPane);
	    upperPane.add(inputPane);
	    
	    inputPane.setBounds(0, 0, 200, 300);
		
		JPanel lowerGrid = new JPanel(new GridLayout(1,3));
		lowerGrid.add(processBtn);
		
		lowerGrid.add(confirmBtn);
		lowerGrid.add(viewOrderBtn);
		lowerGrid.add(finishOrderBtn);
		lowerGrid.add(newOrderBtn);
		lowerGrid.add(exitBtn);
		

		myFrame.add(upperPane, BorderLayout.NORTH);

		myFrame.add(lowerGrid, BorderLayout.SOUTH);
		myFrame.setVisible(true);
    }
}
